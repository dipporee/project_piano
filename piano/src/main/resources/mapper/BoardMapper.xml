<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="com.piano.mapper.BoardMapper">

	<!-- 목록 조회 -->
	<select id="getList" resultType="com.piano.vo.BoardVO">
		SELECT
			B.BOARD_SEQ <!-- , 앞에 쓰기 -->
			,B.BOARD_TITLE
			,B.BOARD_TEXT
			,B.REG_DT
			,B.BOARD_VIEW
			,U.USER_NICKNAME
		FROM
			BOARD AS B <!-- AS 알이아스 적어주기 -->
				LEFT OUTER JOIN USER U 
					ON U.USER_SEQ = B.REG_USER_SEQ <!-- 조인명 다 적어주기 --> <!-- 조인하는 테이	블부터 적기 --> 
		WHERE 
			B.DEL_YN = 'N'
		ORDER BY 
			B.REG_DT DESC
	</select>
	
	<!-- 글 조회 -->
	<select id="getContent" parameterType="long" resultType="com.piano.vo.BoardVO"> 			
			SELECT
				  B.BOARD_SEQ 
				, B.BOARD_TITLE 
				, B.BOARD_TEXT 
				, B.REG_DT 
				, B.BOARD_VIEW
				, U.USER_NICKNAME 
			FROM BOARD B
			JOIN USER U ON U.USER_SEQ = B.REG_USER_SEQ 
			WHERE BOARD_SEQ = #{boardSeq}  		
	</select> 
	
	<!-- 글 작성 -->
	<insert id="contentWrite" parameterType="com.piano.vo.BoardVO">
		INSERT INTO BOARD (
			BOARD_TITLE
			,BOARD_TEXT
			,BOARD_GRP_SEQ
			,REG_USER_SEQ
			,REG_DT
		) VALUES (
			#{boardTitle}
			,#{boardText}
			,#{boardGrpSeq}
			,#{regUserSeq}
			,CURRENT_TIMESTAMP
		)
	</insert>
	
	<!-- 최신 글번호 -->
	<select id="boardSeq" resultType="int"> 
		SELECT 
			MAX(BOARD_SEQ) 
		FROM 
			BOARD
	</select> 

	<!-- 글 수정 -->
	<update id="contentModify" parameterType="com.piano.vo.BoardVO"> 
		UPDATE BOARD
		<trim prefix="SET" prefixOverrides=",">
			<if test='boardTitle != null and boardTitle != ""'>
			,BOARD_TITLE = #{boardTitle}	
			</if>
			<if test='delYn != null and delYn != ""'>
			,DEL_YN = 'N'	
			</if>
			<if test='boardTitle != null and boardTitle != ""'>
			,BOARD_TEXT = #{boardText} 	
			</if>
		</trim>
		WHERE BOARD_SEQ = #{boardSeq} 	
		<!-- <![CDATA[ ]]> --><!-- 진정으로 CDATA 쓸 필요 없으면 쓰기 않기 -->
	</update> 
	
	<!-- 글 삭제 -->
	<update id="contentDelete" parameterType="long"> 
		UPDATE 
			BOARD
		SET 
			DEL_YN = 'N'
		WHERE 
			BOARD_SEQ = #{boardSeq}
	</update>
	
</mapper>	